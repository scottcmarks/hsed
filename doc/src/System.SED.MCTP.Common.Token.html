<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : System.SED.MCTP.Common.Token
Description : SED tokens
Copyright   : (c) Magnolia Heights R&amp;D, 2019
License     : All rights reserved
Maintainer  : scott@magnolia-heights.com
Stability   : experimental

Datatypes for Tokens.
Define the types used in SEDs, and in the hsed program in particular.
-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.SED.MCTP.Common.Token</span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier">Token</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#IsToken"><span class="hs-identifier">IsToken</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#rawTokenSource"><span class="hs-identifier">rawTokenSource</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#removeEmpty"><span class="hs-identifier">removeEmpty</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#combineContinued"><span class="hs-identifier">combineContinued</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#tokenSource"><span class="hs-identifier">tokenSource</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Array</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Attoparsec.ByteString</span></span><span>           </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">takeWhile</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bits</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span>                      </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">map</span></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>                                                       </span><span class="annot"><span class="hs-identifier">take</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeWhile</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsnoc</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Conduit</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Conduit.Attoparsec</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Conduit.Combinators</span></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">takeWhile</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Natural</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">RIO</span></span><span>                                  </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">length</span></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>                                                       </span><span class="annot"><span class="hs-identifier">map</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mask</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">reverse</span></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>                                                       </span><span class="annot"><span class="hs-identifier">take</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">takeWhile</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">RIO</span></span><span>                                  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">map</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span>                      </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">generate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.&amp;.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.Instances.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.Instances.Natural</span></span><span>    </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Text.Printf</span></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.ByteString.Integral.html"><span class="hs-identifier">Data.ByteString.Integral</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="System.SED.MCTP.Common.StreamItem.html"><span class="hs-identifier">System.SED.MCTP.Common.StreamItem</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">{-

Due to the nature of method parameters and results, there are two additional constructs defined for
messaging that serve as grouping mechanisms for the basic types: Named values and List values.

  a. Named values. The name (a byte-string/integer/uinteger value) followed by its value (any
messaging type, i.e. byte-string values, N length signed or unsigned integer values, list values,
or Named values).
  b. List values. Zero or more values of some type, grouped into an ordered list. List tokens are
used to encapsulate method parameters and method results.


Named values and List values serve multiple uses. One use of Named values is to identify optional
method parameters in stream encoding. List tokens are used to encapsulate method parameters or to
separate the InvokingID/MethodID from the method parameters in the stream encoding. For more
information on stream encoding, see 3.2.2.


3.2.2.3 Tokens

Values of the four basic types are packaged into tokens, each of which is a TLV (tag, length, value)
sequence of bits that specifies a single data value.


                                 Table 04 Token Types
+---------------------------------------------+--------+----------+-------------------+
|    Byte                                     |  Hex   | Acronym  | Meaning           |
+---------------+---------+---------+---------+--------+----------+-------------------+
|       0       |    1    |    2    |    3    |        |          |                   |
+-+-+-----------+---------+---------+---------+--------+----------+-------------------+
|0|S|  d&lt;5..0&gt;  |                             | 00..7F |          | Tiny atom         |
+-+-+-+-+-------+-----------------------------+--------+----------+-------------------+
|1|0|B|S|n&lt;3..0&gt;|                             | 80..BF |          | Short atom        |
+-+-+-+-+-+-----+---------+-------------------+--------+----------+-------------------+
|1|1|0|B|S|   n&lt;10..0&gt;    |                   | C0..DF |          | Medium atom       |
+-+-+-+-+-+-+-+-+---------+---------+---------+--------+----------+-------------------+
|1|1|1|0|0|0|B|S|n&lt;23..16&gt;| n&lt;15..8&gt;| n&lt;7..0&gt; | E0..E3 |          | Long atom         |
+-+-+-+-+-+-+-+-+---------+---------+---------+--------+----------+-------------------+
|                                             | E4..EF |       TCG Reserved           |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|0|0|0|0|                             |   F0   |    SL    | Start List        |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|0|0|0|1|                             |   F1   |    EL    | End List          |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|0|0|1|0|                             |   F2   |    SN    | Start Name        |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|0|0|1|1|                             |   F3   |    EN    | End Name          |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|                                             | F4..F7 |       TCG Reserved           |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|1|0|0|0|                             |   F8   |   CALL   | Call              |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|1|0|0|1|                             |   F9   |   EOD    | End of Data       |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|1|0|1|0|                             |   FA   |   EOS    | End of session    |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|1|0|1|1|                             |   FB   |    ST    | Start transaction |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|1|1|0|0|                             |   FC   |    ET    | End transaction   |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|                                             | FD..FE |       TCG Reserved           |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+
|1|1|1|1|1|1|1|1|                             |   FF   |    MT    | Empty atom        |
+-+-+-+-+-+-+-+-+-----------------------------+--------+----------+-------------------+



The Token Types identified in Table 04 are divided into 3 subgroups:

a. Simple Tokens - Atoms: tiny, short, medium, long, and empty atoms
b. Sequence Tokens: Start List, End List, Start Name, and End Name
c. Control Tokens: Call, End of Data, End of Session, Start Transaction, End Transaction



Tokens 0xE4-0xEF, 0xF4-0xF7 and 0xFD-0xFE are reserved for use by TCG.

An SSC MAY define support for only a subset of the available tokens, as well as
the behavior of the TPer when unsupported tokens are transmitted by the host.
-}</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-keyword">data</span><span> </span><span id="Token"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-var">Token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>    </span><span id="Unsigned"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Signed"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Bytes"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-var">Bytes</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ContinuedBytes"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#ContinuedBytes"><span class="hs-identifier hs-var">ContinuedBytes</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="StartName"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#StartName"><span class="hs-identifier hs-var">StartName</span></a></span></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="EndName"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndName"><span class="hs-identifier hs-var">EndName</span></a></span></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="StartList"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#StartList"><span class="hs-identifier hs-var">StartList</span></a></span></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="EndList"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndList"><span class="hs-identifier hs-var">EndList</span></a></span></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Call"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Call"><span class="hs-identifier hs-var">Call</span></a></span></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="EndOfData"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndOfData"><span class="hs-identifier hs-var">EndOfData</span></a></span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="EndOfSession"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndOfSession"><span class="hs-identifier hs-var">EndOfSession</span></a></span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="StartTransaction"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#StartTransaction"><span class="hs-identifier hs-var">StartTransaction</span></a></span></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="EndTransaction"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndTransaction"><span class="hs-identifier hs-var">EndTransaction</span></a></span></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Empty"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679529985"><span id="local-6989586621679529987"><span class="annot"><span class="annottext">Token -&gt; Token -&gt; Bool
(Token -&gt; Token -&gt; Bool) -&gt; (Token -&gt; Token -&gt; Bool) -&gt; Eq Token
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Token -&gt; Token -&gt; Bool
$c/= :: Token -&gt; Token -&gt; Bool
== :: Token -&gt; Token -&gt; Bool
$c== :: Token -&gt; Token -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679529978"><span id="local-6989586621679529980"><span id="local-6989586621679529982"><span class="annot"><span class="annottext">Int -&gt; Token -&gt; ShowS
[Token] -&gt; ShowS
Token -&gt; String
(Int -&gt; Token -&gt; ShowS)
-&gt; (Token -&gt; String) -&gt; ([Token] -&gt; ShowS) -&gt; Show Token
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Token] -&gt; ShowS
$cshowList :: [Token] -&gt; ShowS
show :: Token -&gt; String
$cshow :: Token -&gt; String
showsPrec :: Int -&gt; Token -&gt; ShowS
$cshowsPrec :: Int -&gt; Token -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679530124"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="IsToken"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#IsToken"><span class="hs-identifier hs-var">IsToken</span></a></span></span><span> </span><span id="local-6989586621679530124"><span class="annot"><a href="#local-6989586621679530124"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>    </span><span id="fromToken"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#fromToken"><span class="hs-identifier hs-type">fromToken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679530124"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span id="token"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#token"><span class="hs-identifier hs-type">token</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679530124"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679529974"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#token"><span class="hs-identifier hs-var hs-var">token</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Maybe Token -&gt; Token
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Maybe Token -&gt; Token)
-&gt; (a -&gt; Token) -&gt; a -&gt; Maybe Token -&gt; Token
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Token
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Token) -&gt; (a -&gt; String) -&gt; a -&gt; Token
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Not a Token&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; (a -&gt; String) -&gt; a -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe Token -&gt; Token) -&gt; (a -&gt; Maybe Token) -&gt; a -&gt; Token
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe Token
forall a. IsToken a =&gt; a -&gt; Maybe Token
</span><a href="System.SED.MCTP.Common.Token.html#mtoken"><span class="hs-identifier hs-var">mtoken</span></a></span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>    </span><span id="mtoken"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#mtoken"><span class="hs-identifier hs-type">mtoken</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679530124"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621679529967"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#mtoken"><span class="hs-identifier hs-var hs-var">mtoken</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Maybe Token
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Maybe Token) -&gt; (a -&gt; Token) -&gt; a -&gt; Maybe Token
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Token
forall a. IsToken a =&gt; a -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#token"><span class="hs-identifier hs-var">token</span></a></span></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679529962"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#IsToken"><span class="hs-identifier hs-type">IsToken</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679529960"><span class="annot"><span class="annottext">token :: Token -&gt; Token
</span><a href="#local-6989586621679529960"><span class="hs-identifier hs-var hs-var hs-var hs-var">token</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Token
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679529958"><span class="annot"><span class="annottext">fromToken :: Token -&gt; Maybe Token
</span><a href="#local-6989586621679529958"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Maybe Token
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- * Instances of StreamItem.</span><span>
</span><span id="line-164"></span><span class="hs-comment">--</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679529946"><span id="local-6989586621679529948"><span id="local-6989586621679529950"><span id="local-6989586621679529952"><span id="local-6989586621679529954"><span class="annot"><a href="System.SED.MCTP.Common.StreamItem.html#StreamItem"><span class="hs-identifier hs-type">StreamItem</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679529944"><span class="annot"><span class="annottext">parser :: Parser Token
</span><a href="System.SED.MCTP.Common.StreamItem.html#parser"><span class="hs-identifier hs-var hs-var hs-var hs-var">parser</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Token
</span><a href="System.SED.MCTP.Common.Token.html#tokenParser"><span class="hs-identifier hs-var">tokenParser</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621679529941"><span class="annot"><span class="annottext">generate :: Token -&gt; ByteString
</span><a href="System.SED.MCTP.Common.StreamItem.html#generate"><span class="hs-identifier hs-var hs-var hs-var hs-var">generate</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ByteString
</span><a href="System.SED.MCTP.Common.Token.html#generateToken"><span class="hs-identifier hs-var">generateToken</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-comment">-- | Parse a Token.</span><span>
</span><span id="line-173"></span><span class="hs-comment">--   Dispatch on the first byte, which is the tag, plus some more info.</span><span>
</span><span id="line-174"></span><span class="hs-comment">--   256 thunks continue the parsing to a Parser Token</span><span>
</span><span id="line-175"></span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#tokenParser"><span class="hs-identifier hs-type">tokenParser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span>
</span><span id="line-176"></span><span id="tokenParser"><span class="annot"><span class="annottext">tokenParser :: Parser Token
</span><a href="System.SED.MCTP.Common.Token.html#tokenParser"><span class="hs-identifier hs-var hs-var">tokenParser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Word8
</span><a href="#local-6989586621679529938"><span class="hs-identifier hs-var">pTag</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Word8 -&gt; (Word8 -&gt; Parser Token) -&gt; Parser Token
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Array Word8 (Parser Token)
</span><a href="#local-6989586621679529937"><span class="hs-identifier hs-var">dispatch</span></a></span><span> </span><span class="annot"><span class="annottext">Array Word8 (Parser Token) -&gt; Word8 -&gt; Parser Token
forall i e. Ix i =&gt; Array i e -&gt; i -&gt; e
</span><span class="hs-glyph hs-var">!</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>      </span><span id="local-6989586621679529938"><span class="annot"><span class="annottext">pTag :: Parser Word8
</span><a href="#local-6989586621679529938"><span class="hs-identifier hs-var hs-var">pTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Word8
</span><span class="hs-identifier hs-var">anyWord8</span></span><span>
</span><span id="line-179"></span><span>      </span><span id="local-6989586621679529934"><span class="annot"><span class="annottext">bnds :: (Word8, Word8)
</span><a href="#local-6989586621679529934"><span class="hs-identifier hs-var hs-var">bnds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Word8
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>      </span><span id="local-6989586621679529937"><span class="annot"><span class="annottext">dispatch :: Array Word8 (Parser Token)
</span><a href="#local-6989586621679529937"><span class="hs-identifier hs-var hs-var">dispatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; [Parser Token] -&gt; Array Word8 (Parser Token)
forall i e. Ix i =&gt; (i, i) -&gt; [e] -&gt; Array i e
</span><span class="hs-identifier hs-var">listArray</span></span><span> </span><span class="annot"><span class="annottext">(Word8, Word8)
</span><a href="#local-6989586621679529934"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">([Parser Token] -&gt; Array Word8 (Parser Token))
-&gt; [Parser Token] -&gt; Array Word8 (Parser Token)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Parser Token) -&gt; [Word8] -&gt; [Parser Token]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">R.map</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529930"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; [Word8]
forall a. Ix a =&gt; (a, a) -&gt; [a]
</span><span class="hs-identifier hs-var">range</span></span><span> </span><span class="annot"><span class="annottext">(Word8, Word8)
</span><a href="#local-6989586621679529934"><span class="hs-identifier hs-var">bnds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>      </span><span id="local-6989586621679529930"><span class="annot"><span class="annottext">p :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529930"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679529928"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x00</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0x3F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529926"><span class="hs-identifier hs-var">pTinyUnsigned</span></a></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x40</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0x7F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529925"><span class="hs-identifier hs-var">pTinySigned</span></a></span><span>     </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0x80</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser Token
forall a. String -&gt; Parser ByteString a
</span><a href="#local-6989586621679529924"><span class="hs-identifier hs-var">failLengthZero</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Short&quot;</span></span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x81</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0x8F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529923"><span class="hs-identifier hs-var">pShortUnsigned</span></a></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0x90</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser Token
forall a. String -&gt; Parser ByteString a
</span><a href="#local-6989586621679529924"><span class="hs-identifier hs-var">failLengthZero</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Short&quot;</span></span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x91</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0x9F</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529922"><span class="hs-identifier hs-var">pShortSigned</span></a></span><span>    </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xA0</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Parser ByteString ByteString
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-var">Bytes</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0xA1</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0xAF</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529920"><span class="hs-identifier hs-var">pShortBytes</span></a></span><span>     </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xB0</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser Token
forall a. String -&gt; Parser ByteString a
</span><a href="#local-6989586621679529924"><span class="hs-identifier hs-var">failLengthZero</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Short&quot;</span></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0xB1</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0xBF</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529919"><span class="hs-identifier hs-var">pShortCBytes</span></a></span><span>    </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0xC0</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0xC7</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529918"><span class="hs-identifier hs-var">pMediumUnsigned</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0xC8</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0xCF</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529917"><span class="hs-identifier hs-var">pMediumSigned</span></a></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0xD0</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0xD7</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529916"><span class="hs-identifier hs-var">pMediumBytes</span></a></span><span>    </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Word8, Word8) -&gt; Word8 -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0xD8</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">0xDF</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529915"><span class="hs-identifier hs-var">pMediumCBytes</span></a></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xE0</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Token
</span><a href="#local-6989586621679529914"><span class="hs-identifier hs-var">pLongUnsigned</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xE1</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Token
</span><a href="#local-6989586621679529913"><span class="hs-identifier hs-var">pLongSigned</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xE2</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Token
</span><a href="#local-6989586621679529912"><span class="hs-identifier hs-var">pLongBytes</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xE3</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Token
</span><a href="#local-6989586621679529911"><span class="hs-identifier hs-var">pLongCBytes</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xF0</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#StartList"><span class="hs-identifier hs-var">StartList</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xF1</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndList"><span class="hs-identifier hs-var">EndList</span></a></span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xF2</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#StartName"><span class="hs-identifier hs-var">StartName</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xF3</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndName"><span class="hs-identifier hs-var">EndName</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xF8</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xF9</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndOfData"><span class="hs-identifier hs-var">EndOfData</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xFA</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndOfSession"><span class="hs-identifier hs-var">EndOfSession</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xFB</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#StartTransaction"><span class="hs-identifier hs-var">StartTransaction</span></a></span><span>
</span><span id="line-208"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xFC</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndTransaction"><span class="hs-identifier hs-var">EndTransaction</span></a></span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-glyph">|</span><span>          </span><span class="annot"><span class="hs-number">0xFF</span></span><span>  </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Parser Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Token
forall a. Word8 -&gt; Parser ByteString a
</span><a href="#local-6989586621679529910"><span class="hs-identifier hs-var">failTCGReserved</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529928"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>      </span><span class="hs-comment">-- parsers and constructors</span><span>
</span><span id="line-213"></span><span>      </span><span id="local-6989586621679529926"><span class="annot"><span class="annottext">pTinyUnsigned :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529926"><span class="hs-identifier hs-var hs-var">pTinyUnsigned</span></a></span></span><span>   </span><span id="local-6989586621679529909"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529909"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8
</span><a href="#local-6989586621679529908"><span class="hs-identifier hs-var">pTiny</span></a></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529909"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Word8 -&gt; (Word8 -&gt; Natural) -&gt; Parser ByteString Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Natural
forall a. (Integral a, Bits a) =&gt; a -&gt; Natural
</span><a href="#local-6989586621679529907"><span class="hs-identifier hs-var">tinyUnsigned</span></a></span><span>   </span><span class="annot"><span class="annottext">Parser ByteString Natural -&gt; (Natural -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span id="local-6989586621679529925"><span class="annot"><span class="annottext">pTinySigned :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529925"><span class="hs-identifier hs-var hs-var">pTinySigned</span></a></span></span><span>     </span><span id="local-6989586621679529906"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529906"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8
</span><a href="#local-6989586621679529908"><span class="hs-identifier hs-var">pTiny</span></a></span><span>   </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529906"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Word8 -&gt; (Word8 -&gt; Integer) -&gt; Parser ByteString Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Integer
forall a. (Integral a, Bits a) =&gt; a -&gt; Integer
</span><a href="#local-6989586621679529905"><span class="hs-identifier hs-var">tinySigned</span></a></span><span>     </span><span class="annot"><span class="annottext">Parser ByteString Integer -&gt; (Integer -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>      </span><span id="local-6989586621679529923"><span class="annot"><span class="annottext">pShortUnsigned :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529923"><span class="hs-identifier hs-var hs-var">pShortUnsigned</span></a></span></span><span>  </span><span id="local-6989586621679529904"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529904"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529903"><span class="hs-identifier hs-var">pShort</span></a></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529904"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Natural) -&gt; Parser ByteString Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Natural
forall a. IsByteString a =&gt; ByteString -&gt; a
</span><a href="Data.ByteString.Integral.html#fromByteString"><span class="hs-identifier hs-var">fromByteString</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString Natural -&gt; (Natural -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a></span><span>
</span><span id="line-217"></span><span>      </span><span id="local-6989586621679529922"><span class="annot"><span class="annottext">pShortSigned :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529922"><span class="hs-identifier hs-var hs-var">pShortSigned</span></a></span></span><span>    </span><span id="local-6989586621679529901"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529901"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529903"><span class="hs-identifier hs-var">pShort</span></a></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529901"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Integer) -&gt; Parser ByteString Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Integer
forall a. IsByteString a =&gt; ByteString -&gt; a
</span><a href="Data.ByteString.Integral.html#fromByteString"><span class="hs-identifier hs-var">fromByteString</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString Integer -&gt; (Integer -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span>
</span><span id="line-218"></span><span>      </span><span id="local-6989586621679529920"><span class="annot"><span class="annottext">pShortBytes :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529920"><span class="hs-identifier hs-var hs-var">pShortBytes</span></a></span></span><span>     </span><span id="local-6989586621679529900"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529900"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529903"><span class="hs-identifier hs-var">pShort</span></a></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529900"><span class="hs-identifier hs-var">b</span></a></span><span>                    </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-var">Bytes</span></a></span><span>
</span><span id="line-219"></span><span>      </span><span id="local-6989586621679529919"><span class="annot"><span class="annottext">pShortCBytes :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529919"><span class="hs-identifier hs-var hs-var">pShortCBytes</span></a></span></span><span>    </span><span id="local-6989586621679529899"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529899"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529903"><span class="hs-identifier hs-var">pShort</span></a></span><span>  </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529899"><span class="hs-identifier hs-var">b</span></a></span><span>                    </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#ContinuedBytes"><span class="hs-identifier hs-var">ContinuedBytes</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>      </span><span id="local-6989586621679529918"><span class="annot"><span class="annottext">pMediumUnsigned :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529918"><span class="hs-identifier hs-var hs-var">pMediumUnsigned</span></a></span></span><span> </span><span id="local-6989586621679529898"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529898"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529897"><span class="hs-identifier hs-var">pMedium</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529898"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Natural) -&gt; Parser ByteString Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Natural
forall a. IsByteString a =&gt; ByteString -&gt; a
</span><a href="Data.ByteString.Integral.html#fromByteString"><span class="hs-identifier hs-var">fromByteString</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString Natural -&gt; (Natural -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a></span><span>
</span><span id="line-222"></span><span>      </span><span id="local-6989586621679529917"><span class="annot"><span class="annottext">pMediumSigned :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529917"><span class="hs-identifier hs-var hs-var">pMediumSigned</span></a></span></span><span>   </span><span id="local-6989586621679529896"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529896"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529897"><span class="hs-identifier hs-var">pMedium</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529896"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Integer) -&gt; Parser ByteString Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Integer
forall a. IsByteString a =&gt; ByteString -&gt; a
</span><a href="Data.ByteString.Integral.html#fromByteString"><span class="hs-identifier hs-var">fromByteString</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString Integer -&gt; (Integer -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span>
</span><span id="line-223"></span><span>      </span><span id="local-6989586621679529916"><span class="annot"><span class="annottext">pMediumBytes :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529916"><span class="hs-identifier hs-var hs-var">pMediumBytes</span></a></span></span><span>    </span><span id="local-6989586621679529895"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529895"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529897"><span class="hs-identifier hs-var">pMedium</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529895"><span class="hs-identifier hs-var">b</span></a></span><span>                    </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-var">Bytes</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span id="local-6989586621679529915"><span class="annot"><span class="annottext">pMediumCBytes :: Word8 -&gt; Parser Token
</span><a href="#local-6989586621679529915"><span class="hs-identifier hs-var hs-var">pMediumCBytes</span></a></span></span><span>   </span><span id="local-6989586621679529894"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529894"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529897"><span class="hs-identifier hs-var">pMedium</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529894"><span class="hs-identifier hs-var">b</span></a></span><span>                    </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#ContinuedBytes"><span class="hs-identifier hs-var">ContinuedBytes</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>      </span><span id="local-6989586621679529914"><span class="annot"><span class="annottext">pLongUnsigned :: Parser Token
</span><a href="#local-6989586621679529914"><span class="hs-identifier hs-var hs-var">pLongUnsigned</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679529893"><span class="hs-identifier hs-var">pLong</span></a></span><span>     </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Natural) -&gt; Parser ByteString Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Natural
forall a. IsByteString a =&gt; ByteString -&gt; a
</span><a href="Data.ByteString.Integral.html#fromByteString"><span class="hs-identifier hs-var">fromByteString</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString Natural -&gt; (Natural -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a></span><span>
</span><span id="line-227"></span><span>      </span><span id="local-6989586621679529913"><span class="annot"><span class="annottext">pLongSigned :: Parser Token
</span><a href="#local-6989586621679529913"><span class="hs-identifier hs-var hs-var">pLongSigned</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679529893"><span class="hs-identifier hs-var">pLong</span></a></span><span>     </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Integer) -&gt; Parser ByteString Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Integer
forall a. IsByteString a =&gt; ByteString -&gt; a
</span><a href="Data.ByteString.Integral.html#fromByteString"><span class="hs-identifier hs-var">fromByteString</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString Integer -&gt; (Integer -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span>
</span><span id="line-228"></span><span>      </span><span id="local-6989586621679529912"><span class="annot"><span class="annottext">pLongBytes :: Parser Token
</span><a href="#local-6989586621679529912"><span class="hs-identifier hs-var hs-var">pLongBytes</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679529893"><span class="hs-identifier hs-var">pLong</span></a></span><span>                        </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-var">Bytes</span></a></span><span>
</span><span id="line-229"></span><span>      </span><span id="local-6989586621679529911"><span class="annot"><span class="annottext">pLongCBytes :: Parser Token
</span><a href="#local-6989586621679529911"><span class="hs-identifier hs-var hs-var">pLongCBytes</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679529893"><span class="hs-identifier hs-var">pLong</span></a></span><span>                        </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Token) -&gt; Parser Token
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#ContinuedBytes"><span class="hs-identifier hs-var">ContinuedBytes</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-comment">-- layout parsers</span><span>
</span><span id="line-232"></span><span>      </span><span class="annot"><a href="#local-6989586621679529908"><span class="hs-identifier hs-type">pTiny</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span>
</span><span id="line-233"></span><span>      </span><span id="local-6989586621679529908"><span class="annot"><span class="annottext">pTiny :: Word8 -&gt; Parser Word8
</span><a href="#local-6989586621679529908"><span class="hs-identifier hs-var hs-var">pTiny</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>      </span><span class="annot"><a href="#local-6989586621679529903"><span class="hs-identifier hs-type">pShort</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-236"></span><span>      </span><span id="local-6989586621679529903"><span class="annot"><span class="annottext">pShort :: Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529903"><span class="hs-identifier hs-var hs-var">pShort</span></a></span></span><span>  </span><span id="local-6989586621679529892"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529892"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Parser Word8
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x0F</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529892"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>                 </span><span class="annot"><span class="annottext">Parser Word8 -&gt; (Word8 -&gt; Int) -&gt; Parser ByteString Int
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a. Integral a =&gt; a -&gt; Int
</span><a href="Data.ByteString.Integral.html#int"><span class="hs-identifier hs-var">int</span></a></span><span>
</span><span id="line-238"></span><span>                 </span><span class="annot"><span class="annottext">Parser ByteString Int
-&gt; (Int -&gt; Parser ByteString ByteString)
-&gt; Parser ByteString ByteString
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529889"><span class="hs-identifier hs-var">takeFor</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Short&quot;</span></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><a href="#local-6989586621679529897"><span class="hs-identifier hs-type">pMedium</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-241"></span><span>      </span><span id="local-6989586621679529897"><span class="annot"><span class="annottext">pMedium :: Word8 -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529897"><span class="hs-identifier hs-var hs-var">pMedium</span></a></span></span><span> </span><span id="local-6989586621679529888"><span class="annot"><span class="annottext">b :: Word8
</span><a href="#local-6989586621679529888"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Parser ByteString Int
</span><a href="#local-6989586621679529887"><span class="hs-identifier hs-var">takeLengthFor</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Medium&quot;</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-242"></span><span>                 </span><span class="annot"><span class="annottext">Parser ByteString Int -&gt; (Int -&gt; Int) -&gt; Parser ByteString Int
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int
forall a. Integral a =&gt; a -&gt; Int
</span><a href="Data.ByteString.Integral.html#int"><span class="hs-identifier hs-var">int</span></a></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; Int) -&gt; Word8 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-number">0x07</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529888"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>                 </span><span class="annot"><span class="annottext">Parser ByteString Int
-&gt; (Int -&gt; Parser ByteString Int) -&gt; Parser ByteString Int
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Parser ByteString Int
forall a. (Ord a, Num a) =&gt; String -&gt; a -&gt; Parser ByteString a
</span><a href="#local-6989586621679529884"><span class="hs-identifier hs-var">checkLength</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Medium&quot;</span></span><span>
</span><span id="line-244"></span><span>                 </span><span class="annot"><span class="annottext">Parser ByteString Int
-&gt; (Int -&gt; Parser ByteString ByteString)
-&gt; Parser ByteString ByteString
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529889"><span class="hs-identifier hs-var">takeFor</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Medium&quot;</span></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>      </span><span class="annot"><a href="#local-6989586621679529893"><span class="hs-identifier hs-type">pLong</span></a></span><span>   </span><span class="hs-glyph">::</span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-247"></span><span>      </span><span id="local-6989586621679529893"><span class="annot"><span class="annottext">pLong :: Parser ByteString ByteString
</span><a href="#local-6989586621679529893"><span class="hs-identifier hs-var hs-var">pLong</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Parser ByteString Int
</span><a href="#local-6989586621679529887"><span class="hs-identifier hs-var">takeLengthFor</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Long&quot;</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span>
</span><span id="line-248"></span><span>                 </span><span class="annot"><span class="annottext">Parser ByteString Int
-&gt; (Int -&gt; Parser ByteString Int) -&gt; Parser ByteString Int
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Parser ByteString Int
forall a. (Ord a, Num a) =&gt; String -&gt; a -&gt; Parser ByteString a
</span><a href="#local-6989586621679529884"><span class="hs-identifier hs-var">checkLength</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Long&quot;</span></span><span>
</span><span id="line-249"></span><span>                 </span><span class="annot"><span class="annottext">Parser ByteString Int
-&gt; (Int -&gt; Parser ByteString ByteString)
-&gt; Parser ByteString ByteString
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529889"><span class="hs-identifier hs-var">takeFor</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Long&quot;</span></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-comment">-- conversion to Integral</span><span>
</span><span id="line-252"></span><span>      </span><span id="local-6989586621679529907"><span class="annot"><span class="annottext">tinyUnsigned :: a -&gt; Natural
</span><a href="#local-6989586621679529907"><span class="hs-identifier hs-var hs-var">tinyUnsigned</span></a></span></span><span> </span><span id="local-6989586621679529883"><span class="annot"><span class="annottext">b :: a
</span><a href="#local-6989586621679529883"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Natural
forall a. Integral a =&gt; a -&gt; Natural
</span><a href="Data.ByteString.Integral.html#natural"><span class="hs-identifier hs-var">natural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x3F</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529883"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621679529905"><span class="annot"><span class="annottext">tinySigned :: a -&gt; Integer
</span><a href="#local-6989586621679529905"><span class="hs-identifier hs-var hs-var">tinySigned</span></a></span></span><span>   </span><span id="local-6989586621679529881"><span class="annot"><span class="annottext">b :: a
</span><a href="#local-6989586621679529881"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x20</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529881"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="Data.ByteString.Integral.html#integer"><span class="hs-identifier hs-var">integer</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529879"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="Data.ByteString.Integral.html#integer"><span class="hs-identifier hs-var">integer</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529879"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="hs-number">0x20</span></span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679529879"><span class="annot"><span class="annottext">d :: a
</span><a href="#local-6989586621679529879"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0x1F</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529881"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span>      </span><span class="hs-comment">-- zero length checks for Medium and Long lengths</span><span>
</span><span id="line-257"></span><span>      </span><span class="hs-comment">-- (Short lengths are checked syntacticaly, and Tiny has only the tag)</span><span>
</span><span id="line-258"></span><span>      </span><span id="local-6989586621679529924"><span class="annot"><span class="annottext">failLengthZero :: String -&gt; Parser ByteString a
</span><a href="#local-6989586621679529924"><span class="hs-identifier hs-var hs-var">failLengthZero</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser ByteString a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser ByteString a)
-&gt; ShowS -&gt; String -&gt; Parser ByteString a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; Atom with illegal length 0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>      </span><span id="local-6989586621679529884"><span class="annot"><span class="annottext">checkLength :: String -&gt; a -&gt; Parser ByteString a
</span><a href="#local-6989586621679529884"><span class="hs-identifier hs-var hs-var">checkLength</span></a></span></span><span>   </span><span id="local-6989586621679529878"><span class="annot"><span class="annottext">sz :: String
</span><a href="#local-6989586621679529878"><span class="hs-identifier hs-var">sz</span></a></span></span><span>  </span><span id="local-6989586621679529877"><span class="annot"><span class="annottext">l :: a
</span><a href="#local-6989586621679529877"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529877"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; Parser ByteString a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529877"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser ByteString a
forall a. String -&gt; Parser ByteString a
</span><a href="#local-6989586621679529924"><span class="hs-identifier hs-var">failLengthZero</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679529878"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span id="local-6989586621679529910"><span class="annot"><span class="annottext">failTCGReserved :: Word8 -&gt; Parser ByteString a
</span><a href="#local-6989586621679529910"><span class="hs-identifier hs-var hs-var">failTCGReserved</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Parser ByteString a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Parser ByteString a)
-&gt; (Word8 -&gt; String) -&gt; Word8 -&gt; Parser ByteString a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Word8 -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="hs-string">&quot;TCG Reserved Token Type 0x%02X&quot;</span></span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><a href="#local-6989586621679529887"><span class="hs-identifier hs-type">takeLengthFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-262"></span><span>      </span><span id="local-6989586621679529887"><span class="annot"><span class="annottext">takeLengthFor :: String -&gt; Int -&gt; Parser ByteString Int
</span><a href="#local-6989586621679529887"><span class="hs-identifier hs-var hs-var">takeLengthFor</span></a></span></span><span> </span><span id="local-6989586621679529874"><span class="annot"><span class="annottext">sz :: String
</span><a href="#local-6989586621679529874"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679529873"><span class="annot"><span class="annottext">l :: Int
</span><a href="#local-6989586621679529873"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
</span><a href="#local-6989586621679529872"><span class="hs-identifier hs-var">take'</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; (ByteString -&gt; Natural) -&gt; Parser ByteString Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Natural
</span><a href="Data.ByteString.Integral.html#byteStringToNatural"><span class="hs-identifier hs-var">byteStringToNatural</span></a></span><span>  </span><span class="annot"><span class="annottext">Parser ByteString Natural
-&gt; (Natural -&gt; Int) -&gt; Parser ByteString Int
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Int
forall a. Integral a =&gt; a -&gt; Int
</span><a href="Data.ByteString.Integral.html#int"><span class="hs-identifier hs-var">int</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679529872"><span class="annot"><span class="annottext">take' :: Parser ByteString ByteString
</span><a href="#local-6989586621679529872"><span class="hs-identifier hs-var hs-var">take'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679529873"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; String -&gt; Parser ByteString ByteString
forall i a. Parser i a -&gt; String -&gt; Parser i a
</span><span class="hs-operator hs-var">&lt;?&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String
forall a. (Show a, Eq a, Num a) =&gt; String -&gt; a -&gt; String
</span><a href="#local-6989586621679529868"><span class="hs-identifier hs-var">lengthError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679529874"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679529873"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><a href="#local-6989586621679529889"><span class="hs-identifier hs-type">takeFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-265"></span><span>      </span><span id="local-6989586621679529889"><span class="annot"><span class="annottext">takeFor :: String -&gt; Int -&gt; Parser ByteString ByteString
</span><a href="#local-6989586621679529889"><span class="hs-identifier hs-var hs-var">takeFor</span></a></span></span><span>       </span><span id="local-6989586621679529867"><span class="annot"><span class="annottext">sz :: String
</span><a href="#local-6989586621679529867"><span class="hs-identifier hs-var">sz</span></a></span></span><span>  </span><span id="local-6989586621679529866"><span class="annot"><span class="annottext">l :: Int
</span><a href="#local-6989586621679529866"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Parser ByteString ByteString
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679529866"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Parser ByteString ByteString
-&gt; String -&gt; Parser ByteString ByteString
forall i a. Parser i a -&gt; String -&gt; Parser i a
</span><span class="hs-operator hs-var">&lt;?&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; String
forall a. (Show a, Eq a, Num a) =&gt; String -&gt; a -&gt; String
</span><a href="#local-6989586621679529865"><span class="hs-identifier hs-var">bytesError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679529867"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679529866"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span id="local-6989586621679529864"><span class="annot"><span class="annottext">szerror :: String -&gt; a -&gt; ShowS
</span><a href="#local-6989586621679529864"><span class="hs-identifier hs-var hs-var">szerror</span></a></span></span><span> </span><span id="local-6989586621679529863"><span class="annot"><span class="annottext">sz1 :: String
</span><a href="#local-6989586621679529863"><span class="hs-identifier hs-var">sz1</span></a></span></span><span> </span><span id="local-6989586621679529862"><span class="annot"><span class="annottext">l :: a
</span><a href="#local-6989586621679529862"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679529861"><span class="annot"><span class="annottext">sz2 :: String
</span><a href="#local-6989586621679529861"><span class="hs-identifier hs-var">sz2</span></a></span></span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-267"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;Needed &quot;</span></span><span>
</span><span id="line-268"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529862"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-269"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529862"><span class="hs-identifier hs-var">l</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-string">&quot; byte for &quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-string">&quot; bytes for &quot;</span></span><span>
</span><span id="line-270"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679529863"><span class="hs-identifier hs-var">sz1</span></a></span><span>
</span><span id="line-271"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-272"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679529861"><span class="hs-identifier hs-var">sz2</span></a></span><span>
</span><span id="line-273"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-274"></span><span>      </span><span id="local-6989586621679529868"><span class="annot"><span class="annottext">lengthError :: String -&gt; a -&gt; String
</span><a href="#local-6989586621679529868"><span class="hs-identifier hs-var hs-var">lengthError</span></a></span></span><span> </span><span id="local-6989586621679529860"><span class="annot"><span class="annottext">sz :: String
</span><a href="#local-6989586621679529860"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679529859"><span class="annot"><span class="annottext">l :: a
</span><a href="#local-6989586621679529859"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a -&gt; ShowS
forall a. (Show a, Eq a, Num a) =&gt; String -&gt; a -&gt; ShowS
</span><a href="#local-6989586621679529864"><span class="hs-identifier hs-var">szerror</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679529860"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529859"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Token length&quot;</span></span><span>
</span><span id="line-275"></span><span>      </span><span id="local-6989586621679529865"><span class="annot"><span class="annottext">bytesError :: String -&gt; a -&gt; String
</span><a href="#local-6989586621679529865"><span class="hs-identifier hs-var hs-var">bytesError</span></a></span></span><span> </span><span id="local-6989586621679529858"><span class="annot"><span class="annottext">sz :: String
</span><a href="#local-6989586621679529858"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621679529857"><span class="annot"><span class="annottext">l :: a
</span><a href="#local-6989586621679529857"><span class="hs-identifier hs-var">l</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a -&gt; ShowS
forall a. (Show a, Eq a, Num a) =&gt; String -&gt; a -&gt; ShowS
</span><a href="#local-6989586621679529864"><span class="hs-identifier hs-var">szerror</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679529858"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529857"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Token&quot;</span></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#generateToken"><span class="hs-identifier hs-type">generateToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span>
</span><span id="line-278"></span><span id="generateToken"><span class="annot"><span class="annottext">generateToken :: Token -&gt; ByteString
</span><a href="System.SED.MCTP.Common.Token.html#generateToken"><span class="hs-identifier hs-var hs-var">generateToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Token -&gt; ByteString
</span><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679529856"><span class="annot"><span class="annottext">go :: Token -&gt; ByteString
</span><a href="#local-6989586621679529856"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Unsigned"><span class="hs-identifier hs-type">Unsigned</span></a></span><span>       </span><span id="local-6989586621679529855"><span class="annot"><span class="annottext">n :: Natural
</span><a href="#local-6989586621679529855"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ByteString
</span><a href="#local-6989586621679529854"><span class="hs-identifier hs-var">unsigned</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679529855"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Signed"><span class="hs-identifier hs-type">Signed</span></a></span><span>         </span><span id="local-6989586621679529853"><span class="annot"><span class="annottext">i :: Integer
</span><a href="#local-6989586621679529853"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ByteString
</span><a href="#local-6989586621679529852"><span class="hs-identifier hs-var">signed</span></a></span><span>   </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679529853"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-type">Bytes</span></a></span><span>          </span><span id="local-6989586621679529851"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679529851"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679529850"><span class="hs-identifier hs-var">bytes</span></a></span><span>   </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529851"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#ContinuedBytes"><span class="hs-identifier hs-type">ContinuedBytes</span></a></span><span> </span><span id="local-6989586621679529849"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679529849"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="#local-6989586621679529848"><span class="hs-identifier hs-var">cbytes</span></a></span><span>  </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529849"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xFF</span></span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#StartList"><span class="hs-identifier hs-type">StartList</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xF0</span></span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndList"><span class="hs-identifier hs-type">EndList</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xF1</span></span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#StartName"><span class="hs-identifier hs-type">StartName</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xF2</span></span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndName"><span class="hs-identifier hs-type">EndName</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xF3</span></span><span>
</span><span id="line-289"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xF8</span></span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndOfData"><span class="hs-identifier hs-type">EndOfData</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xF9</span></span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndOfSession"><span class="hs-identifier hs-type">EndOfSession</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xFA</span></span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#StartTransaction"><span class="hs-identifier hs-type">StartTransaction</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xFB</span></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><a href="#local-6989586621679529856"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#EndTransaction"><span class="hs-identifier hs-type">EndTransaction</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="hs-number">0xFC</span></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>    </span><span id="local-6989586621679529854"><span class="annot"><span class="annottext">unsigned :: Natural -&gt; ByteString
</span><a href="#local-6989586621679529854"><span class="hs-identifier hs-var hs-var">unsigned</span></a></span></span><span> </span><span id="local-6989586621679529846"><span class="annot"><span class="annottext">n :: Natural
</span><a href="#local-6989586621679529846"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Natural, Natural) -&gt; Natural -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">63</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679529846"><span class="hs-identifier hs-var">n</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x00</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="hs-number">0x3F</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Word8
forall a. Integral a =&gt; a -&gt; Word8
</span><a href="Data.ByteString.Integral.html#byte"><span class="hs-identifier hs-var">byte</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679529846"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; ByteString -&gt; ByteString
</span><a href="#local-6989586621679529844"><span class="hs-identifier hs-var">tlv</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ByteString
</span><a href="Data.ByteString.Integral.html#naturalToByteString"><span class="hs-identifier hs-var">naturalToByteString</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679529846"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679529852"><span class="annot"><span class="annottext">signed :: Integer -&gt; ByteString
</span><a href="#local-6989586621679529852"><span class="hs-identifier hs-var hs-var">signed</span></a></span></span><span>   </span><span id="local-6989586621679529842"><span class="annot"><span class="annottext">i :: Integer
</span><a href="#local-6989586621679529842"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Integer, Integer) -&gt; Integer -&gt; Bool
forall a. Ix a =&gt; (a, a) -&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">inRange</span></span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="hs-number">32</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-number">31</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679529842"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0x40</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="hs-number">0x3F</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.&amp;.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Word8
forall a. Integral a =&gt; a -&gt; Word8
</span><a href="Data.ByteString.Integral.html#byte"><span class="hs-identifier hs-var">byte</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679529842"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; ByteString -&gt; ByteString
</span><a href="#local-6989586621679529844"><span class="hs-identifier hs-var">tlv</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ByteString
</span><a href="Data.ByteString.Integral.html#integerToByteString"><span class="hs-identifier hs-var">integerToByteString</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679529842"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span id="local-6989586621679529850"><span class="annot"><span class="annottext">bytes :: ByteString -&gt; ByteString
</span><a href="#local-6989586621679529850"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; ByteString -&gt; ByteString
</span><a href="#local-6989586621679529844"><span class="hs-identifier hs-var">tlv</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-302"></span><span>    </span><span id="local-6989586621679529848"><span class="annot"><span class="annottext">cbytes :: ByteString -&gt; ByteString
</span><a href="#local-6989586621679529848"><span class="hs-identifier hs-var hs-var">cbytes</span></a></span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; ByteString -&gt; ByteString
</span><a href="#local-6989586621679529844"><span class="hs-identifier hs-var">tlv</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679529844"><span class="annot"><span class="annottext">tlv :: Word8 -&gt; Word8 -&gt; ByteString -&gt; ByteString
</span><a href="#local-6989586621679529844"><span class="hs-identifier hs-var hs-var">tlv</span></a></span></span><span> </span><span id="local-6989586621679529840"><span class="annot"><span class="annottext">_B :: Word8
</span><a href="#local-6989586621679529840"><span class="hs-identifier hs-var">_B</span></a></span></span><span> </span><span id="local-6989586621679529839"><span class="annot"><span class="annottext">_S :: Word8
</span><a href="#local-6989586621679529839"><span class="hs-identifier hs-var">_S</span></a></span></span><span> </span><span id="local-6989586621679529838"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679529838"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Int -&gt; ByteString
forall a. (Integral a, Bits a) =&gt; Word8 -&gt; Word8 -&gt; a -&gt; ByteString
</span><a href="#local-6989586621679529837"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529840"><span class="hs-identifier hs-var">_B</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529839"><span class="hs-identifier hs-var">_S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529838"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529838"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621679529837"><span class="annot"><span class="annottext">tl :: Word8 -&gt; Word8 -&gt; a -&gt; ByteString
</span><a href="#local-6989586621679529837"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679529835"><span class="annot"><span class="annottext">_B :: Word8
</span><a href="#local-6989586621679529835"><span class="hs-identifier hs-var">_B</span></a></span></span><span> </span><span id="local-6989586621679529834"><span class="annot"><span class="annottext">_S :: Word8
</span><a href="#local-6989586621679529834"><span class="hs-identifier hs-var">_S</span></a></span></span><span> </span><span id="local-6989586621679529833"><span class="annot"><span class="annottext">l :: a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span></span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">0x0F</span></span><span> </span><span class="hs-glyph">=</span><span>            </span><span class="hs-comment">-- Small</span><span>
</span><span id="line-307"></span><span>              </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; ByteString) -&gt; Word8 -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="hs-number">0x80</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529831"><span class="hs-identifier hs-var">_BS</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Word8
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Word8
forall a. Integral a =&gt; a -&gt; Word8
</span><a href="Data.ByteString.Integral.html#byte"><span class="hs-identifier hs-var">byte</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">0x7FF</span></span><span> </span><span class="hs-glyph">=</span><span>           </span><span class="hs-comment">-- Medium</span><span>
</span><span id="line-309"></span><span>              </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0xC0</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529831"><span class="hs-identifier hs-var">_BS</span></a></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Word8
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftL`</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Word8
forall a. Integral a =&gt; a -&gt; Word8
</span><a href="Data.ByteString.Integral.html#byte"><span class="hs-identifier hs-var">byte</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>           </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ByteString
</span><a href="#local-6989586621679529829"><span class="hs-identifier hs-var">byte0</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="hs-number">0xFFFFFFFFFFFF</span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">-- Long</span><span>
</span><span id="line-312"></span><span>              </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0xE0</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529831"><span class="hs-identifier hs-var">_BS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>           </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ByteString
</span><a href="#local-6989586621679529828"><span class="hs-identifier hs-var">byte2</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ByteString
</span><a href="#local-6989586621679529827"><span class="hs-identifier hs-var">byte1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; ByteString
</span><a href="#local-6989586621679529829"><span class="hs-identifier hs-var">byte0</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529833"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-314"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Generated Atom byte sequence impossibly long!&quot;</span></span><span>
</span><span id="line-315"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679529831"><span class="annot"><span class="annottext">_BS :: Word8
</span><a href="#local-6989586621679529831"><span class="hs-identifier hs-var hs-var">_BS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Int -&gt; Word8
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">shiftL</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529835"><span class="hs-identifier hs-var">_B</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; Word8 -&gt; Word8
forall a. Bits a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">.|.</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621679529834"><span class="hs-identifier hs-var">_S</span></a></span><span>
</span><span id="line-316"></span><span>            </span><span id="local-6989586621679529829"><span class="annot"><span class="annottext">byte0 :: a -&gt; ByteString
</span><a href="#local-6989586621679529829"><span class="hs-identifier hs-var hs-var">byte0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; ByteString
</span><span class="hs-identifier hs-var">singleton</span></span><span> </span><span class="annot"><span class="annottext">(Word8 -&gt; ByteString) -&gt; (a -&gt; Word8) -&gt; a -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Word8
forall a. Integral a =&gt; a -&gt; Word8
</span><a href="Data.ByteString.Integral.html#byte"><span class="hs-identifier hs-var">byte</span></a></span><span>
</span><span id="line-317"></span><span>            </span><span id="local-6989586621679529827"><span class="annot"><span class="annottext">byte1 :: a -&gt; ByteString
</span><a href="#local-6989586621679529827"><span class="hs-identifier hs-var hs-var">byte1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ByteString
</span><a href="#local-6989586621679529829"><span class="hs-identifier hs-var">byte0</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ByteString) -&gt; (a -&gt; a) -&gt; a -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="hs-number">8</span></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>            </span><span id="local-6989586621679529828"><span class="annot"><span class="annottext">byte2 :: a -&gt; ByteString
</span><a href="#local-6989586621679529828"><span class="hs-identifier hs-var hs-var">byte2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; ByteString
</span><a href="#local-6989586621679529829"><span class="hs-identifier hs-var">byte0</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ByteString) -&gt; (a -&gt; a) -&gt; a -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Int -&gt; a
forall a. Bits a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">`shiftR`</span></span><span> </span><span class="annot"><span class="hs-number">16</span></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- * Arbitrary instances for testing</span><span>
</span><span id="line-321"></span><span class="hs-comment">--</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679529824"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679529822"><span class="annot"><span class="annottext">arbitrary :: Gen Token
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, Gen Token)] -&gt; Gen Token
forall a. [(Int, Gen a)] -&gt; Gen a
</span><span class="hs-identifier hs-var">frequency</span></span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Unsigned"><span class="hs-identifier hs-var">Unsigned</span></a></span><span>       </span><span class="annot"><span class="annottext">(Natural -&gt; Token) -&gt; Gen Natural -&gt; Gen Token
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen Natural
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Signed"><span class="hs-identifier hs-var">Signed</span></a></span><span>         </span><span class="annot"><span class="annottext">(Integer -&gt; Token) -&gt; Gen Integer -&gt; Gen Token
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen Integer
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">15</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-var">Bytes</span></a></span><span>          </span><span class="annot"><span class="annottext">(ByteString -&gt; Token) -&gt; Gen ByteString -&gt; Gen Token
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen ByteString
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#ContinuedBytes"><span class="hs-identifier hs-var">ContinuedBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Token) -&gt; Gen ByteString -&gt; Gen Token
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Gen ByteString
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Gen Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#StartName"><span class="hs-identifier hs-var">StartName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Gen Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndName"><span class="hs-identifier hs-var">EndName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Gen Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#StartList"><span class="hs-identifier hs-var">StartList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Gen Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndList"><span class="hs-identifier hs-var">EndList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Gen Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndOfData"><span class="hs-identifier hs-var">EndOfData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Gen Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndOfSession"><span class="hs-identifier hs-var">EndOfSession</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Gen Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#StartTransaction"><span class="hs-identifier hs-var">StartTransaction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Gen Token
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#EndTransaction"><span class="hs-identifier hs-var">EndTransaction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span id="local-6989586621679530029"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#rawTokenSource"><span class="hs-identifier hs-type">rawTokenSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679530029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PositionRange</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679530029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-340"></span><span id="rawTokenSource"><span class="annot"><span class="annottext">rawTokenSource :: ConduitT ByteString (PositionRange, Token) m ()
</span><a href="System.SED.MCTP.Common.Token.html#rawTokenSource"><span class="hs-identifier hs-var hs-var">rawTokenSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Token -&gt; ConduitT ByteString (PositionRange, Token) m ()
forall a (m :: * -&gt; *) b.
(AttoparsecInput a, MonadThrow m) =&gt;
Parser a b -&gt; ConduitT a (PositionRange, b) m ()
</span><span class="hs-identifier hs-var">conduitParser</span></span><span> </span><span class="annot"><span class="annottext">Parser Token
forall a. StreamItem a =&gt; Parser a
</span><a href="System.SED.MCTP.Common.StreamItem.html#parser"><span class="hs-identifier hs-var">parser</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span id="local-6989586621679530022"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#removeEmpty"><span class="hs-identifier hs-type">removeEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679530022"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PositionRange</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PositionRange</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679530022"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-343"></span><span id="removeEmpty"><span class="annot"><span class="annottext">removeEmpty :: ConduitT (PositionRange, Token) (PositionRange, Token) m ()
</span><a href="System.SED.MCTP.Common.Token.html#removeEmpty"><span class="hs-identifier hs-var hs-var">removeEmpty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((PositionRange, Token) -&gt; Bool)
-&gt; ConduitT (PositionRange, Token) (PositionRange, Token) m ()
forall (m :: * -&gt; *) a. Monad m =&gt; (a -&gt; Bool) -&gt; ConduitT a a m ()
</span><span class="hs-identifier hs-var">takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Token -&gt; Token -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="System.SED.MCTP.Common.Token.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Bool)
-&gt; ((PositionRange, Token) -&gt; Token)
-&gt; (PositionRange, Token)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PositionRange, Token) -&gt; Token
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span id="local-6989586621679529817"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#combineContinued"><span class="hs-identifier hs-type">combineContinued</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679529817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PositionRange</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PositionRange</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679529817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-346"></span><span id="combineContinued"><span class="annot"><span class="annottext">combineContinued :: ConduitT (PositionRange, Token) (PositionRange, Token) m ()
</span><a href="System.SED.MCTP.Common.Token.html#combineContinued"><span class="hs-identifier hs-var hs-var">combineContinued</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (PositionRange, ByteString)
-&gt; ConduitT (PositionRange, Token) (PositionRange, Token) m ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
Maybe (a, ByteString) -&gt; ConduitT (a, Token) (a, Token) m ()
</span><a href="#local-6989586621679529816"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (PositionRange, ByteString)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621679529816"><span class="annot"><span class="annottext">loop :: Maybe (a, ByteString) -&gt; ConduitT (a, Token) (a, Token) m ()
</span><a href="#local-6989586621679529816"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679529815"><span class="annot"><span class="annottext">mpacc :: Maybe (a, ByteString)
</span><a href="#local-6989586621679529815"><span class="hs-identifier hs-var">mpacc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConduitT (a, Token) (a, Token) m (Maybe (a, Token))
forall (m :: * -&gt; *) i. Monad m =&gt; Consumer i m (Maybe i)
</span><span class="hs-identifier hs-var">await</span></span><span> </span><span class="annot"><span class="annottext">ConduitT (a, Token) (a, Token) m (Maybe (a, Token))
-&gt; (Maybe (a, Token) -&gt; ConduitT (a, Token) (a, Token) m ())
-&gt; ConduitT (a, Token) (a, Token) m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Maybe (a, ByteString)
-&gt; Maybe (a, Token) -&gt; ConduitT (a, Token) (a, Token) m ()
</span><a href="#local-6989586621679529813"><span class="hs-identifier hs-var">examine</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (a, ByteString)
</span><a href="#local-6989586621679529815"><span class="hs-identifier hs-var">mpacc</span></a></span><span>
</span><span id="line-349"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-350"></span><span>         </span><span id="local-6989586621679529813"><span class="annot"><span class="annottext">examine :: Maybe (a, ByteString)
-&gt; Maybe (a, Token) -&gt; ConduitT (a, Token) (a, Token) m ()
</span><a href="#local-6989586621679529813"><span class="hs-identifier hs-var hs-var">examine</span></a></span></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679529812"><span class="annot"><span class="annottext">pos :: a
</span><a href="#local-6989586621679529812"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#ContinuedBytes"><span class="hs-identifier hs-type">ContinuedBytes</span></a></span><span> </span><span id="local-6989586621679529811"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679529811"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Maybe (a, ByteString) -&gt; ConduitT (a, Token) (a, Token) m ()
</span><a href="#local-6989586621679529816"><span class="hs-identifier hs-var">loop</span></a></span><span>  </span><span class="annot"><span class="annottext">(Maybe (a, ByteString) -&gt; ConduitT (a, Token) (a, Token) m ())
-&gt; Maybe (a, ByteString) -&gt; ConduitT (a, Token) (a, Token) m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a, ByteString) -&gt; Maybe (a, ByteString)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529812"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529811"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>         </span><span class="annot"><a href="#local-6989586621679529813"><span class="hs-identifier hs-var">examine</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679529810"><span class="annot"><span class="annottext">pos :: a
</span><a href="#local-6989586621679529810"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679529809"><span class="annot"><span class="annottext">acc :: ByteString
</span><a href="#local-6989586621679529809"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#ContinuedBytes"><span class="hs-identifier hs-type">ContinuedBytes</span></a></span><span> </span><span id="local-6989586621679529808"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679529808"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Maybe (a, ByteString) -&gt; ConduitT (a, Token) (a, Token) m ()
</span><a href="#local-6989586621679529816"><span class="hs-identifier hs-var">loop</span></a></span><span>  </span><span class="annot"><span class="annottext">(Maybe (a, ByteString) -&gt; ConduitT (a, Token) (a, Token) m ())
-&gt; Maybe (a, ByteString) -&gt; ConduitT (a, Token) (a, Token) m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a, ByteString) -&gt; Maybe (a, ByteString)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529810"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">append</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529809"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529808"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>         </span><span class="annot"><a href="#local-6989586621679529813"><span class="hs-identifier hs-var">examine</span></a></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679529806"><span class="annot"><span class="annottext">pos :: a
</span><a href="#local-6989586621679529806"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679529805"><span class="annot"><span class="annottext">t :: Token
</span><a href="#local-6989586621679529805"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(a, Token) -&gt; ConduitT (a, Token) (a, Token) m ()
forall (m :: * -&gt; *) o i. Monad m =&gt; o -&gt; ConduitT i o m ()
</span><span class="hs-identifier hs-var">yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529806"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="#local-6989586621679529805"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>         </span><span class="annot"><a href="#local-6989586621679529813"><span class="hs-identifier hs-var">examine</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679529803"><span class="annot"><span class="annottext">pos :: a
</span><a href="#local-6989586621679529803"><span class="hs-identifier hs-var">pos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679529802"><span class="annot"><span class="annottext">acc :: ByteString
</span><a href="#local-6989586621679529802"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-type">Bytes</span></a></span><span> </span><span id="local-6989586621679529801"><span class="annot"><span class="annottext">bs :: ByteString
</span><a href="#local-6989586621679529801"><span class="hs-identifier hs-var">bs</span></a></span></span><span>         </span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(a, Token) -&gt; ConduitT (a, Token) (a, Token) m ()
forall (m :: * -&gt; *) o i. Monad m =&gt; o -&gt; ConduitT i o m ()
</span><span class="hs-identifier hs-var">yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679529803"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Token
</span><a href="System.SED.MCTP.Common.Token.html#Bytes"><span class="hs-identifier hs-var">Bytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">append</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529802"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679529801"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>         </span><span class="annot"><a href="#local-6989586621679529813"><span class="hs-identifier hs-var">examine</span></a></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>                          </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">() -&gt; ConduitT (a, Token) (a, Token) m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>  </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>         </span><span class="annot"><a href="#local-6989586621679529813"><span class="hs-identifier hs-var">examine</span></a></span><span>  </span><span class="hs-identifier">_</span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>                          </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">String -&gt; ConduitT (a, Token) (a, Token) m ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;ContinuedBytes not finished&quot;</span></span><span>
</span><span id="line-356"></span><span>         </span><span class="annot"><a href="#local-6989586621679529813"><span class="hs-identifier hs-var">examine</span></a></span><span>  </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-identifier">_</span><span>                                </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">String -&gt; ConduitT (a, Token) (a, Token) m ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="hs-string">&quot;ContinuedBytes followed by non-Bytes&quot;</span></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span id="local-6989586621679529800"><span class="annot"><a href="System.SED.MCTP.Common.Token.html#tokenSource"><span class="hs-identifier hs-type">tokenSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679529800"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PositionRange</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="System.SED.MCTP.Common.Token.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679529800"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-359"></span><span id="tokenSource"><span class="annot"><span class="annottext">tokenSource :: ConduitT ByteString (PositionRange, Token) m ()
</span><a href="System.SED.MCTP.Common.Token.html#tokenSource"><span class="hs-identifier hs-var hs-var">tokenSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConduitT ByteString (PositionRange, Token) m ()
forall (m :: * -&gt; *).
MonadThrow m =&gt;
ConduitT ByteString (PositionRange, Token) m ()
</span><a href="System.SED.MCTP.Common.Token.html#rawTokenSource"><span class="hs-identifier hs-var">rawTokenSource</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitT ByteString (PositionRange, Token) m ()
-&gt; ConduitM (PositionRange, Token) (PositionRange, Token) m ()
-&gt; ConduitT ByteString (PositionRange, Token) m ()
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitM a b m () -&gt; ConduitM b c m r -&gt; ConduitM a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">ConduitM (PositionRange, Token) (PositionRange, Token) m ()
forall (m :: * -&gt; *).
Monad m =&gt;
ConduitT (PositionRange, Token) (PositionRange, Token) m ()
</span><a href="System.SED.MCTP.Common.Token.html#removeEmpty"><span class="hs-identifier hs-var">removeEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitM (PositionRange, Token) (PositionRange, Token) m ()
-&gt; ConduitM (PositionRange, Token) (PositionRange, Token) m ()
-&gt; ConduitM (PositionRange, Token) (PositionRange, Token) m ()
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitM a b m () -&gt; ConduitM b c m r -&gt; ConduitM a c m r
</span><span class="hs-operator hs-var">.|</span></span><span> </span><span class="annot"><span class="annottext">ConduitM (PositionRange, Token) (PositionRange, Token) m ()
forall (m :: * -&gt; *).
Monad m =&gt;
ConduitT (PositionRange, Token) (PositionRange, Token) m ()
</span><a href="System.SED.MCTP.Common.Token.html#combineContinued"><span class="hs-identifier hs-var">combineContinued</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="hs-comment">{-*
3.2.2.3.1 Simple Tokens -- Atoms Overview

Atoms are used to encode data of various sizes and types. Atoms MAY be tiny
atoms, which are one byte in length; short atoms which have a 1-byte header and
contain up to 15 bytes of data; medium atoms which have a 2-byte header and
contain up to 2047 bytes of data; or long atoms which have a 4-byte header and
which contain up to 16,777,215 bytes of data.

Tiny atoms only represent integers, whereas short, medium, and long atoms are
used to represent integers or bytes (with the `B' bit set).

A continued value is used to represent a long byte sequence when the total
length is not known in advance. A continued value is represented by a sequence
of two or more atoms.

Each atom in a continued value MAY be a short atom, medium atom, or long. The
BS bits are set to 11b for all atoms except the last atom, for which the BS bits
are set to 10b. All representations of continued are considered equivalent
encodings of the same value.

Integer and uinteger values SHOULD be encoded using the shortest possible atom.


3.2.2.3.1.1 Tiny atoms

Tiny atom header and data are all contained in eight bits.


   Table 05 Tiny Atom Description
    +--------------------------+
    |      Header + Data       |
    +---------+----+-----------+
    |Tiny atom|sign|   data    |
    +---------+----+-+-+-+-+-+-+
    |    0    | S  |d|d|d|d|d|d|
    +---------+----+-+-+-+-+-+-+


The encoding is as follows:

                          Table 06 Tiny Atom Encoding
    +----------+----------------------------------------------------------+
    |Tiny Atom | This bit is set to 0b to indicate the atom is a tiny atom|
    |indicator |                                                          |
    +----------+----------------------------------------------------------+
    |Sign      |Value Interpretation                                      |
    |indicator | 0b   The data is treated as unsigned integer data.       |
    |          | 1b   The data is treated as a signed integer.            |
    +----------+----------------------------------------------------------+
    |Data bits |These represent the data value, an unsigned value in the  |
    |          |range of 0...63 or a signed value in the range of         |
    |          |-32...31. The interpretation is based on the setting of   |
    |          |the sign bit.                                             |
    +----------+----------------------------------------------------------+


3.2.2.3.1.2 Short atoms

Short atoms consist of a one-byte header and between 0 and 15 bytes of data.

                 Table 07 Short Atom Description
    +---------------------------------------+---------------+
    |            Header (1 byte)            |     Data      |
    +-----------+---------+---------+-------+---------------+
    |Short Atom |byte/    |sign/    |length |(0...15 bytes) |
    |           |integer  |continued|       |               |
    +-----+-----+---------+---------+-+-+-+-+---+-------+---+
    |  1  |  0  |  B      |  S      |n|n|n|n| d |  ...  | d |
    +-----+-----+---------+---------+-+-+-+-+---+-------+---+


The encoding is as follows:


                                       Table 08 Short Atom Encoding
    +----------------+--------------------------------------------------------------------------------+
    |Short Atom      |These two bits are set to 10b to indicate the atom is a short atom.             |
    |indicator       |                                                                                |
    +----------------+--------------------------------------------------------------------------------+
    |Byte/integer    | Value Interpretation                                                           |
    |indicator       | 0b    The data bytes represent an integer value and the S bit indicates if that|
    |                |       value is signed.                                                         |
    |                | 1b    The data bytes represent a byte sequence and the S bit indicates whether |
    |                |       or not this value is continued into another atom.                        |
    +----------------+------+-------------------------------------------------------------------------+
    |Sign/continued  | Value Interpretation                                                           |
    |indicator       | 0b    The interpretation of the data depends on the byte/integer indicator bit.|
    |                |        B==0b  The data is treated as unsigned integer data.                    |
    |                |        B==1b  The data is either the complete byte sequence, or the final      |
    |                |               segment of a continued byte sequence.                            |
    |                | 1b    The interpretation of the data depends on the byte/integer indicator bit.|
    |                |        B==0b  The data is treated as signed integer data.                      |
    |                |        B==1b  The data is a non-final segment of a multi-byte continued value. |
    +----------------+--------------------------------------------------------------------------------+
    |Length          |These bits specify the length of the following data byte sequence. The permitted|
    |                |range is from 0 to 15, inclusive.                                               |
    +----------------+--------------------------------------------------------------------------------+

A length of 0 SHALL only be permitted for non-continued bytes tokens The encoding of a 0-length byte
value is displayed in Table 09.

         Table 09 0-Length Byte Encoding
    +---------------------------------------+
    |            Header (1 byte)            |
    +-----------+---------+---------+-------+
    |Short Atom |byte/    |sign/    |length |
    |           |integer  |continued|       |
    +-----+-----+---------+---------+-+-+-+-+
    |  1  |  0  |  1      |  0      |0|0|0|0|
    +-----+-----+---------+---------+-+-+-+-+

A 0-length byte value is encoded using only 1 byte: 1 0 1 0 0 0 0 0. This value would be encoded in
the token stream as 0xA0.


3.2.2.3.1.3 Medium atoms

Medium atoms consist of a two-byte header, and between 1 and 2047 bytes of data.

                        Table 10 Medium Atom Description
    +---------------------------------------------------------+----------------+
    |                    Header (2 bytes)                     |      Data      |
    +-------------------------------------------+-------------+----------------+
    |                    0                      |     1       |      ...       |
    +-----------------+---------+---------+-----+-------------+----------------+
    |  Medium Atom    |byte/    |sign/    |      length       |(1...2047 bytes)|
    |                 |integer  |continued|                   |                |
    +-----+-----+-----+---------+---------+-+-+-+-+-+-+-+-+-+-+---+-------+----+
    |  1  |  1  |  0  |    B    |    S    |n|n|n|n|n|n|n|n|n|n| d |  ...  | d  |
    +-----+-----+-----+---------+---------+-+-+-+-+-+-+-+-+-+-+---+-------+----+


The encoding is as follows:

                                     Table 11 Medium Atom Encoding
    +---------------+--------------------------------------------------------------------------------+
    |Medium Atom    | These three bits are set to 110b to indicate the atom is a medium atom.        |
    |indicator      |                                                                                |
    +---------------+--------------------------------------------------------------------------------+
    |Byte/integer   | Value Interpretation                                                           |
    |indicator      | 0b    The data bytes represent an integer value and the S bit indicates if that|
    |               |       value is signed.                                                         |
    |               | 1b    The data bytes represent a byte sequence and the S bit indicates whether |
    |               |       or not this value is continued into another atom.                        |
    +---------------+------+-------------------------------------------------------------------------+
    |Sign/continued | Value Interpretation                                                           |
    |indicator      | 0b    The interpretation of the data depends on the byte/integer indicator bit.|
    |               |        B==0b  The data is treated as unsigned integer data.                    |
    |               |        B==1b  The data is either the complete byte sequence, or the final      |
    |               |               segment of a continued byte sequence.                            |
    |               | 1b    The interpretation of the data depends on the byte/integer indicator bit.|
    |               |        B==0b  The data is treated as signed integer data.                      |
    |               |        B==1b  The data is a non-final segment of a multi-byte continued value. |
    +---------------+--------------------------------------------------------------------------------+
    |Length         |These bits specify the length of the following data byte sequence. The value 0  |
    |               |is not a legal value. The permitted range is up to 2047.                        |
    +---------------+--------------------------------------------------------------------------------+


3.2.2.3.1.4 Long atoms

Long atoms consist of a four-byte header, and between 1 and 16M-1 bytes of data.

                            Table 12 Long Atom Description
    +-------------------------------------------------------------------------------------------------------+----------------+
    |                                           Header (4 bytes)                                            |      Data      |
    +-------------------------------------------------------+---------------+---------------+---------------+----------------+
    |                           0                           |        1      |       2       |       3       |      ...       |
    +-----------------------+-----------+---------+---------+---------------+---------------+---------------+----------------+
    |            Long       | reserved  |byte/    |sign/    |                    length                     |(1..16,777,215  |
    |            Atom       |           |integer  |continued|                                               |bytes)          |
    +-----+-----+-----+-----+-----+-----+---------+---------+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+---+-------+----+
    |  1  |  1  |  1  |  0  |  0  |  0  |    B    |    S    |n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n|n| d |  ...  | d  |
    +-----+-----+-----+-----+-----+-----+---------+---------+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+---+-------+----+


The encoding is as follows:

                                     Table 13 Long Atom Encoding
    +---------------+--------------------------------------------------------------------------------+
    |Long Atom      | These three bits are set to 110b to indicate the atom is a medium atom.        |
    |indicator      |                                                                                |
    +---------------+--------------------------------------------------------------------------------+
    |Byte/integer   | Value Interpretation                                                           |
    |indicator      | 0b    The data bytes represent an integer value and the S bit indicates if that|
    |               |       value is signed.                                                         |
    |               | 1b    The data bytes represent a byte sequence and the S bit indicates whether |
    |               |       or not this value is continued into another atom.                        |
    +---------------+------+-------------------------------------------------------------------------+
    |Sign/continued | Value Interpretation                                                           |
    |indicator      | 0b    The interpretation of the data depends on the byte/integer indicator bit.|
    |               |        B==0b  The data is treated as unsigned integer data.                    |
    |               |        B==1b  The data is either the complete byte sequence, or the final      |
    |               |               segment of a continued byte sequence.                            |
    |               | 1b    The interpretation of the data depends on the byte/integer indicator bit.|
    |               |        B==0b  The data is treated as signed integer data.                      |
    |               |        B==1b  The data is a non-final segment of a multi-byte continued value. |
    +---------------+--------------------------------------------------------------------------------+
    |Length         |These bits specify the length of the following data byte sequence. The value 0  |
    |               |is not a legal value. The permitted range is up to 16,777,215.                  |
    +---------------+--------------------------------------------------------------------------------+




3.2.2.3.1.5 Empty Atom

The Empty atom is one byte consisting of eight 1 bits.

Table 14 Empty Atom Description
    +---------------+
    |Header (1 byte)|
    +---------------+
    |  Empty Atom   |
    +-+-+-+-+-+-+-+-+
    |1|1|1|1|1|1|1|1|
    +-+-+-+-+-+-+-+-+

The Empty atom MAY appear at any point in the stream encoding where any other atom is able to
appear, including between the atoms of a continued value and after the End of Session, and it SHALL
be ignored.

Begin Informative Content

The Empty atom does not encode values. The Empty atom allows other values in the data subpacket
contained in that part of the stream to be aligned with multi-byte boundaries for efficiency. It also allows
areas of a fixed buffer to be filled with a value that is able to be safely ignored.

End Informative Content

3.2.2.3.2 Sequence Tokens

Composite values, such as Named values and lists, are represented by a sequence of tokens.

3.2.2.3.2.1 Named

Named values have the expositional form name=value and are used to represent a name-value pair. A
Named value is a sequence of tokens: a Start Name token (SN), followed by a non-continued byte-
string/uinteger/integer value that specifies the name, followed by any value (including list or a Named
value), followed by an End Name token (EN).

3.2.2.3.2.2 List

Lists are ordered sequences of elements of the form [e1,e2,...,ei]. List elements MAY be tokens,
lists, or Named values. A list is encoded as a Start List token (SL) followed by a sequence of zero or
more elements followed by an End List token (EL).



3.2.2.3.3 Control Tokens

Control tokens are single byte tokens that are used to specify special actions.

3.2.2.3.3.1 Call (CALL)

This token is used to indicate the start of a method invocation.

3.2.2.3.3.2 End of Data (EOD)

This token is used to signal the end of the parameters, or the result, of a method invocation. This token
is used in message streams by both the host and the SP.

3.2.2.3.3.3 End of Session (EOS)

The host application utilizes this token to signal to the SP that it is ending the session. The SP
responds to this token with an End of Session token of its own in its response stream.

3.2.2.3.3.4 Start Transaction (ST)

The host application utilizes this token to open a transaction.

When the host begins a transaction, the Start Transaction token is sent by the host to the SP along with
the status, a uinteger, required for that transaction control token. The status supplied by the host with
the Start Transaction token SHOULD be a 0x00, and SHALL be ignored by the TPer.

When the SP delivers its response to the host application's message, the SP's message SHALL mirror
that of the host by including Start Transaction tokens in the corresponding places in the message
stream. The TPer SHALL supply the status of the Start Transaction request. If the host sends a non-
zero status code with the Start Transaction token, the device SHALL respond with a status code of
0x00, unless the transaction was unable to start.

If the host transmits a Start Transaction token that causes the transaction nesting limit to be exceeded,
the TPer SHALL abort the session (see Properties Section for details on the transaction nesting limit).
If for any reason the TPer is unable to start a transaction as requested by the host, the TPer SHALL
abort the session.

  Table 15 Start Transaction Status Codes
    +-----------------------------------------+----------+
    |Start Transaction Status Code (uinteger) | Meaning  |
    +-----------------------------------------+----------+
    |                   0x00                  | Success  |
    +-----------------------------------------+----------+
    |                   &gt;0x00                 | Reserved |
    +-----------------------------------------+----------+


3.2.2.3.3.5 End Transaction (ET)

The host application utilizes this token to commit or abort the associated open transaction level.

When the host ends the transaction, the End Transaction token is sent by the host to the SP along with
the uinteger status required by the host for that transaction control token.

When the SP delivers its response to the host application's message, the SP's message SHALL mirror
that of the host by including End Transaction tokens in the equivalent places in the message stream
along with the actual status of the End Transaction request.

The host SHOULD send a status code of 0x00 or 0x01 with an End Transaction token. A status code of
0x00 signals to the device that the host is committing that transaction level. A status code of 0x01
signals to the device that the host is aborting that transaction level and the TPer SHALL abort that
transaction level.



If the host sends a status code of 0x00, the device SHALL attempt to commit that transaction level, and
SHALL return either 0x00 in the case of a successfully committed transaction or 0x01 in the case of an
unsuccessfully committed transaction.



If the host sends a status code with an End Transaction token that the device does not support, the
device SHALL abort the transaction and return a status code of 0x01.

Host delivery of the End Transaction token with a status code other than 0x00 signals that the host is
aborting the transaction. The TPer SHALL abort that transaction level.

SP delivery of the End Transaction token with a status code other than 0x00 signals that the SP
aborted the transaction.


            Table 16 End Transaction Status Codes
    +----------------------------------------+----------+
    | End Transaction Status Code (uinteger) | Meaning  |
    +----------------------------------------+----------+
    |                    0x00                | Commit   |
    +----------------------------------------+----------+
    |                    0x01                | Abort    |
    +----------------------------------------+----------+
    |                    &gt;0x01               | Reserved |
    +----------------------------------------+----------+


3.2.2.3.4 Out of Order Control Tokens

In cases where the host transmits out of order control tokens the TPer SHOULD abort the session.
These cases include (but are not limited to):

  a. Multiple consecutive control tokens of the same type where this repetition is not permitted. This
     includes the Call, End of Data, and End of Session tokens.
  b. Out of order control tokens


Any tokens encoded after an End of Session token SHALL be ignored by the TPer.

3.2.2.4 Invalid and Unexpected Tokens

3.2.2.4.1 Invalid Tokens

An invalid token is a token that is not supported by the TPer's current communications configuration.

The list of invalid tokens is as follows:

  1. A token whose size is greater than the TPer's MaxIndTokenSize property.
  2. A token whose size is greater than the TPer's MaxAggTokenSize property.
  3. A continued token, if the TPer does not support continued tokens (the ContinuedTokens
     property is reported by the TPer as FALSE).
  4. Transaction Control tokens, if the TPer does not support transactions (the MaxTransactionLimit
     property is omitted from the TPer's Properties method response).
  5. Unsupported simple tokens (ie if an SSC does not require support for certain simple tokens).
  6. A TCG Reserved token.


When an invalid token appears in a communication from the host, the TPer SHALL behave as follows:

  1. For regular sessions the TPer SHALL abort the session associated with the Packet that
     contained the violating token. Results for methods that were completed before the violating
     token was encountered SHALL be sent to the host.
  2. For control sessions the TPer SHALL stop processing the packet where the violating token
     occurs, and ignore the remainder of the packet. Results for methods completed before the
     violating token was encountered SHALL be sent to the host.




3.2.2.4.2 Unexpected Tokens

An unexpected token is an otherwise valid and supported token that, based on the construction of a
Subpacket payload, is not a token of the type that is expected, by the construction of the Subpacket
payload, to occupy a particular position in that payload.

Begin Informative Content

For example, in the construction of a method invocation, the beginning of the Subpacket payload
(discounting empty atoms) has the following structure:

  1. Call       -- the Call token
  2. InvokingID -- a byte token
  3. MethodID   -- a byte token
  4. StartList  -- the StartList token


If the beginning of the Subpacket payload was sent by the host as follows: Call token + uinteger token +
byte token + StartList token; then the uinteger token that appears between Call and the byte token
would be unexpected, as the expected token is a byte token.

End Informative Content

Given no other encoding errors in the Subpacket payload, or any other layer of the protocol stack, the
result of inclusion of an unexpected token SHALL be on e of the following, based on the conditions
stated in each item:

  1. For a regular session, abort the session (Note that the TPer is always free to abort the session
     at any time for any reason). For a control session, ignore the remainder of the packet. Results
     for methods that were completed before the violating token was encountered SHALL be sent to
     the host.
  2. If the unexpected token appears outside of a method invocation, at any position in the
     subpacket other than after a Call token and before the next End of Data token after that Call
     token, abort the session for a regular session or, for a control session, ignore the remainder of
     the packet. Results for methods that were completed before the violating token was
     encountered SHALL be sent to the host.
  3. If the unexpected token appears within a method invocation after the Call token but before a
     the first StartList token after that Call token (ie in the method header) for a method invoked
     within a regular session, the method fails and the TPer responds with an empty method result
     list and a method status of NOT_AUTHORIZED. If the unexpected token appears within a
     method invocation after the Call token but before the first StartList token after that Call token for
     a method invoked within a control session, the method SHALL be ignored.
  4. If the unexpected token appears within a method invocation after parameter StartList and
     before the End of Data token (ie in the method parameter list), the method fails and the TPer
     responds with a method result list that MAY be empty, and a method status of
     INVALID_PARAMETER. This includes type mismatches for parameter values.
  5. If the unexpected token appears between the StartList token that marks the beginning of the
     Status List, and the EndList token that marks the end of the Status List, abort the session for a
     regular session or, for a control session, ignore the remainder of the packet. Results for
     methods that were completed before the violating token was encountered SHALL be sent to the
     host. Note that the status list is a list of unsigned integers, so the appearance of a signed
     integer, or any other non-uinteger token, is unexpected.


If empty atoms are supported, then they SHALL NOT be unexpected tokens.



-}</span><span>
</span><span id="line-808"></span></pre></body></html>